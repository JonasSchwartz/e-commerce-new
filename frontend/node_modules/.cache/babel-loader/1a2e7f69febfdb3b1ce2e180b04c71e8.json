{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import axios from'axios';import React,{useContext,useEffect,useReducer}from'react';import{useNavigate}from'react-router-dom';import{Helmet}from'react-helmet-async';import LoadingBox from'../components/LoadingBox';import{Store}from'../Store';import{getError}from'../utils';import Button from\"react-bootstrap/Button\";import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var reducer=function reducer(state,action){switch(action.type){case'FETCH_REQUEST':return _objectSpread(_objectSpread({},state),{},{loading:true});case'FETCH_SUCCESS':return _objectSpread(_objectSpread({},state),{},{users:action.payload,loading:false});case'FETCH_FAIL':return _objectSpread(_objectSpread({},state),{},{loading:false,error:action.payload});case'DELETE_REQUEST':return _objectSpread(_objectSpread({},state),{},{loadingDelete:true,successDelete:false});case'DELETE_SUCCESS':return _objectSpread(_objectSpread({},state),{},{loadingDelete:false,successDelete:true});case'DELETE_FAIL':return _objectSpread(_objectSpread({},state),{},{loadingDelete:false});case'DELETE_RESET':return _objectSpread(_objectSpread({},state),{},{loadingDelete:false,successDelete:false});default:return state;}};export default function UserListScreen(){var navigate=useNavigate(Store);var _useReducer=useReducer(reducer,{loading:true,error:''}),_useReducer2=_slicedToArray(_useReducer,2),_useReducer2$=_useReducer2[0],loading=_useReducer2$.loading,error=_useReducer2$.error,users=_useReducer2$.users,loadingDelete=_useReducer2$.loadingDelete,successDelete=_useReducer2$.successDelete,dispatch=_useReducer2[1];var _useContext=useContext(Store),state=_useContext.state;var userInfo=state.userInfo;useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axios$get,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get(\"/api/users\",{headers:{Authorization:\"Bearer \".concat(userInfo.token)}});case 3:_yield$axios$get=_context.sent;data=_yield$axios$get.data;dispatch({type:'FETCH_SUCCESS',payload:data});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);dispatch({type:'FETCH_FAIL',payload:getError(_context.t0)});case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();if(successDelete){dispatch({type:'DELETE_RESET'});}else{fetchData();}},[userInfo,successDelete]);var deleteHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(user){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!window.confirm('Är du säker?')){_context2.next=13;break;}_context2.prev=1;dispatch({type:'DELETE_REQUEST'});_context2.next=5;return axios.delete(\"/api/users/\".concat(user._id),{headers:{Authorization:\"Bearer \".concat(userInfo.token)}});case 5:toast.success('Användare Borttagen');dispatch({type:'DELETE_SUCCESS'});_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);toast.error(getError(error));dispatch({type:'DELETE_FAIL'});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function deleteHandler(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:\"Anv\\xE4ndare\"})}),/*#__PURE__*/_jsx(\"h1\",{children:\"Anv\\xE4ndare\"}),loadingDelete&&/*#__PURE__*/_jsx(LoadingBox,{}),loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(LoadingBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Namn\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Admin\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:users.map(function(user){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:user._id}),/*#__PURE__*/_jsx(\"td\",{children:user.name}),/*#__PURE__*/_jsx(\"td\",{children:user.email}),/*#__PURE__*/_jsx(\"td\",{children:user.isAdmin?'Ja':'Nej'}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"light\",onClick:function onClick(){return navigate(\"/admin/user/\".concat(user._id));},children:\"\\xC4ndra\"}),\"\\xA0\",/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"light\",disabled:user.isAdmin,onClick:function onClick(){return deleteHandler(user);},children:\"Radera\"})]})]},user._id);})})]})]});}","map":{"version":3,"names":["axios","React","useContext","useEffect","useReducer","useNavigate","Helmet","LoadingBox","Store","getError","Button","toast","reducer","state","action","type","loading","users","payload","error","loadingDelete","successDelete","UserListScreen","navigate","dispatch","userInfo","fetchData","get","headers","Authorization","token","data","deleteHandler","user","window","confirm","delete","_id","success","map","name","email","isAdmin"],"sources":["C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/src/screens/UserListScreen.js"],"sourcesContent":["import axios from 'axios';\r\nimport React, { useContext, useEffect, useReducer } from 'react'\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Helmet } from 'react-helmet-async';\r\nimport LoadingBox from '../components/LoadingBox';\r\nimport { Store } from '../Store';\r\nimport { getError } from '../utils';\r\nimport Button from \"react-bootstrap/Button\"\r\nimport { toast } from 'react-toastify';\r\n\r\n\r\nconst reducer = (state,action) => {\r\n    switch (action.type) {\r\n        case 'FETCH_REQUEST':\r\n            return {...state,loading: true }\r\n            case 'FETCH_SUCCESS':\r\n                return {...state,\r\n                        users: action.payload,\r\n                    loading:false,\r\n                };\r\n                case 'FETCH_FAIL':\r\n                    return {\r\n                        ...state,loading:false, error: action.payload\r\n                    };\r\n\r\n                    case 'DELETE_REQUEST':\r\n                        return {...state, loadingDelete: true, successDelete: false}\r\n                    case 'DELETE_SUCCESS':\r\n                        return {\r\n                            ...state,\r\n                             loadingDelete: false,\r\n                            successDelete: true\r\n                           }    \r\n                           case 'DELETE_FAIL':\r\n                            return {...state, loadingDelete: false}\r\n                           case 'DELETE_RESET':\r\n                            return {...state, loadingDelete: false, successDelete: false}\r\n        default:\r\n            return state;\r\n    }\r\n}   \r\n    \r\n\r\nexport default function UserListScreen() {\r\n    const navigate = useNavigate(Store)\r\n    const [{loading, error,users, loadingDelete, successDelete}, dispatch] = useReducer(reducer, {\r\n        loading:true,\r\n        error:''\r\n    });\r\n\r\n    const {state} = useContext(Store)\r\n    const {userInfo} = state;\r\n\r\n\r\n   \r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                    const {data} = await axios.get(`/api/users`, {\r\n                        headers: {Authorization: `Bearer ${userInfo.token}`}\r\n                    });\r\n    \r\n                    dispatch({type: 'FETCH_SUCCESS', payload: data})\r\n            } catch (err) {\r\n                dispatch ({\r\n                    type:'FETCH_FAIL',\r\n                    payload:getError(err)\r\n                })\r\n            }\r\n    \r\n       }\r\n\r\n       if(successDelete) {\r\n        dispatch({type:'DELETE_RESET'})\r\n       } else {\r\n         fetchData();\r\n       }\r\n\r\n      \r\n\r\n    }, [userInfo, successDelete])\r\n\r\n    const deleteHandler = async (user) => {\r\n        if (window.confirm('Är du säker?')) {\r\n            try {\r\n                dispatch({type:'DELETE_REQUEST'})\r\n                await axios.delete(`/api/users/${user._id}`, {\r\n                    headers: {Authorization: `Bearer ${userInfo.token}`}\r\n                })\r\n                toast.success('Användare Borttagen')\r\n                dispatch({type:'DELETE_SUCCESS'})\r\n            } catch (err) {\r\n                \r\n                    toast.error(getError(error))\r\n                    dispatch({\r\n                        type:'DELETE_FAIL'\r\n\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n  return (\r\n     <div>\r\n    <Helmet>\r\n\r\n    <title>Användare</title>\r\n    </Helmet>\r\n   \r\n    <h1>Användare</h1>\r\n    {loadingDelete && <LoadingBox></LoadingBox>}\r\n    {loading ? (\r\n        <LoadingBox></LoadingBox>\r\n    ) : error ? (\r\n        <LoadingBox variant=\"danger\">{error}</LoadingBox>\r\n    ): (\r\n        <table className='table'>\r\n                <thead>\r\n                    <tr>\r\n                        <th>ID</th>\r\n                        <th>Namn</th>\r\n                        <th>Email</th>\r\n                        <th>Admin</th>\r\n                        <th>Actions</th>\r\n                        \r\n                    </tr>\r\n                </thead>\r\n        <tbody>\r\n        {users.map((user) => (\r\n            <tr key={user._id}>\r\n                <td>{user._id}</td>\r\n                <td>{user.name}</td>\r\n                <td>{user.email}</td>\r\n                <td>{user.isAdmin ? 'Ja' : 'Nej'}</td>\r\n                <td>\r\n                    <Button\r\n                    type=\"button\"\r\n                    variant=\"light\"\r\n                    onClick={() => navigate(`/admin/user/${user._id}`)}\r\n                    >\r\n                        Ändra\r\n                   \r\n                        \r\n                    </Button>\r\n                    &nbsp;   \r\n                    <Button\r\n                    type='button'\r\n                    variant='light'\r\n                    disabled={user.isAdmin}\r\n                    onClick={() => deleteHandler(user)}\r\n                    >\r\n                        Radera\r\n                    </Button>\r\n                </td>\r\n                </tr>\r\n\r\n        ))}\r\n\r\n        </tbody>\r\n\r\n\r\n        </table>\r\n    )}\r\n\r\n    </div>\r\n  )\r\n}\r\n"],"mappings":"2iBAAA,MAAOA,MAAP,KAAkB,OAAlB,CACA,MAAOC,MAAP,EAAgBC,UAAhB,CAA4BC,SAA5B,CAAuCC,UAAvC,KAAyD,OAAzD,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,OAASC,MAAT,KAAuB,oBAAvB,CACA,MAAOC,WAAP,KAAuB,0BAAvB,CACA,OAASC,KAAT,KAAsB,UAAtB,CACA,OAASC,QAAT,KAAyB,UAAzB,CACA,MAAOC,OAAP,KAAmB,wBAAnB,CACA,OAASC,KAAT,KAAsB,gBAAtB,C,wFAGA,GAAMC,QAAO,CAAG,QAAVA,QAAU,CAACC,KAAD,CAAOC,MAAP,CAAkB,CAC9B,OAAQA,MAAM,CAACC,IAAf,EACI,IAAK,eAAL,CACI,sCAAWF,KAAX,MAAiBG,OAAO,CAAE,IAA1B,GACA,IAAK,eAAL,CACI,sCAAWH,KAAX,MACQI,KAAK,CAAEH,MAAM,CAACI,OADtB,CAEIF,OAAO,CAAC,KAFZ,GAIA,IAAK,YAAL,CACI,sCACOH,KADP,MACaG,OAAO,CAAC,KADrB,CAC4BG,KAAK,CAAEL,MAAM,CAACI,OAD1C,GAIA,IAAK,gBAAL,CACI,sCAAWL,KAAX,MAAkBO,aAAa,CAAE,IAAjC,CAAuCC,aAAa,CAAE,KAAtD,GACJ,IAAK,gBAAL,CACI,sCACOR,KADP,MAEKO,aAAa,CAAE,KAFpB,CAGIC,aAAa,CAAE,IAHnB,GAKG,IAAK,aAAL,CACC,sCAAWR,KAAX,MAAkBO,aAAa,CAAE,KAAjC,GACD,IAAK,cAAL,CACC,sCAAWP,KAAX,MAAkBO,aAAa,CAAE,KAAjC,CAAwCC,aAAa,CAAE,KAAvD,GACpB,QACI,MAAOR,MAAP,CA1BR,CA4BH,CA7BD,CAgCA,cAAe,SAASS,eAAT,EAA0B,CACrC,GAAMC,SAAQ,CAAGlB,WAAW,CAACG,KAAD,CAA5B,CACA,gBAAyEJ,UAAU,CAACQ,OAAD,CAAU,CACzFI,OAAO,CAAC,IADiF,CAEzFG,KAAK,CAAC,EAFmF,CAAV,CAAnF,0EAAQH,OAAR,eAAQA,OAAR,CAAiBG,KAAjB,eAAiBA,KAAjB,CAAuBF,KAAvB,eAAuBA,KAAvB,CAA8BG,aAA9B,eAA8BA,aAA9B,CAA6CC,aAA7C,eAA6CA,aAA7C,CAA6DG,QAA7D,iBAKA,gBAAgBtB,UAAU,CAACM,KAAD,CAA1B,CAAOK,KAAP,aAAOA,KAAP,CACA,GAAOY,SAAP,CAAmBZ,KAAnB,CAAOY,QAAP,CAKAtB,SAAS,CAAC,UAAM,CACZ,GAAMuB,UAAS,4FAAG,qMAEe1B,MAAK,CAAC2B,GAAN,cAAwB,CACzCC,OAAO,CAAE,CAACC,aAAa,kBAAYJ,QAAQ,CAACK,KAArB,CAAd,CADgC,CAAxB,CAFf,uCAECC,IAFD,kBAECA,IAFD,CAMNP,QAAQ,CAAC,CAACT,IAAI,CAAE,eAAP,CAAwBG,OAAO,CAAEa,IAAjC,CAAD,CAAR,CANM,+EAQVP,QAAQ,CAAE,CACNT,IAAI,CAAC,YADC,CAENG,OAAO,CAACT,QAAQ,aAFV,CAAF,CAAR,CARU,oEAAH,kBAATiB,UAAS,0CAAf,CAgBD,GAAGL,aAAH,CAAkB,CACjBG,QAAQ,CAAC,CAACT,IAAI,CAAC,cAAN,CAAD,CAAR,CACA,CAFD,IAEO,CACLW,SAAS,GACV,CAIH,CAzBQ,CAyBN,CAACD,QAAD,CAAWJ,aAAX,CAzBM,CAAT,CA2BA,GAAMW,cAAa,6FAAG,kBAAOC,IAAP,4HACdC,MAAM,CAACC,OAAP,CAAe,cAAf,CADc,4CAGVX,QAAQ,CAAC,CAACT,IAAI,CAAC,gBAAN,CAAD,CAAR,CAHU,uBAIJf,MAAK,CAACoC,MAAN,sBAA2BH,IAAI,CAACI,GAAhC,EAAuC,CACzCT,OAAO,CAAE,CAACC,aAAa,kBAAYJ,QAAQ,CAACK,KAArB,CAAd,CADgC,CAAvC,CAJI,QAOVnB,KAAK,CAAC2B,OAAN,CAAc,qBAAd,EACAd,QAAQ,CAAC,CAACT,IAAI,CAAC,gBAAN,CAAD,CAAR,CARU,mFAWNJ,KAAK,CAACQ,KAAN,CAAYV,QAAQ,CAACU,KAAD,CAApB,EACAK,QAAQ,CAAC,CACLT,IAAI,CAAC,aADA,CAAD,CAAR,CAZM,sEAAH,kBAAbiB,cAAa,6CAAnB,CAoBF,mBACG,oCACD,KAAC,MAAD,wBAEA,uCAFA,EADC,cAMD,oCANC,CAOAZ,aAAa,eAAI,KAAC,UAAD,IAPjB,CAQAJ,OAAO,cACJ,KAAC,UAAD,IADI,CAEJG,KAAK,cACL,KAAC,UAAD,EAAY,OAAO,CAAC,QAApB,UAA8BA,KAA9B,EADK,cAGL,eAAO,SAAS,CAAC,OAAjB,wBACQ,oCACI,mCACI,0BADJ,cAEI,4BAFJ,cAGI,6BAHJ,cAII,6BAJJ,cAKI,+BALJ,GADJ,EADR,cAWA,uBACCF,KAAK,CAACsB,GAAN,CAAU,SAACN,IAAD,qBACP,mCACI,oBAAKA,IAAI,CAACI,GAAV,EADJ,cAEI,oBAAKJ,IAAI,CAACO,IAAV,EAFJ,cAGI,oBAAKP,IAAI,CAACQ,KAAV,EAHJ,cAII,oBAAKR,IAAI,CAACS,OAAL,CAAe,IAAf,CAAsB,KAA3B,EAJJ,cAKI,mCACI,KAAC,MAAD,EACA,IAAI,CAAC,QADL,CAEA,OAAO,CAAC,OAFR,CAGA,OAAO,CAAE,yBAAMnB,SAAQ,uBAAgBU,IAAI,CAACI,GAArB,EAAd,EAHT,sBADJ,qBAWI,KAAC,MAAD,EACA,IAAI,CAAC,QADL,CAEA,OAAO,CAAC,OAFR,CAGA,QAAQ,CAAEJ,IAAI,CAACS,OAHf,CAIA,OAAO,CAAE,yBAAMV,cAAa,CAACC,IAAD,CAAnB,EAJT,oBAXJ,GALJ,GAASA,IAAI,CAACI,GAAd,CADO,EAAV,CADD,EAXA,GAbH,GADH,CAgED"},"metadata":{},"sourceType":"module"}