{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useContext,useEffect,useReducer}from'react';import{Store}from\"../Store\";import axios from\"axios\";import{getError}from'../utils';import{useNavigate}from\"react-router-dom\";import{Helmet}from\"react-helmet-async\";import LoadingBox from\"../components/LoadingBox\";import MessageBox from\"../components/MessageBox\";import Button from\"react-bootstrap/Button\";import{toast}from\"react-toastify\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var reducer=function reducer(state,action){switch(action.type){case'FETCH_REQUEST':return _objectSpread(_objectSpread({},state),{},{loading:true});case'FETCH_SUCCESS':return _objectSpread(_objectSpread({},state),{},{orders:action.payload,loading:false});case'FETCH_FAIL':return _objectSpread(_objectSpread({},state),{},{loading:false,error:action.payload});case'DELETE_REQUEST':return _objectSpread(_objectSpread({},state),{},{loadingDelete:true,successDelete:false});case'DELETE_SUCCESS':return _objectSpread(_objectSpread({},state),{},{loadingDelete:false,successDelete:true});case'DELETE_FAIL':return _objectSpread(_objectSpread({},state),{},{loadingDelete:true});case'DELETE_RESET':return _objectSpread(_objectSpread({},state),{},{loadingDelete:false,successDelete:false});default:return state;}};export default function OrderListScreen(){var navigate=useNavigate();var _useContext=useContext(Store),state=_useContext.state;var userInfo=state.userInfo;var _useReducer=useReducer(reducer,{loading:true,error:''}),_useReducer2=_slicedToArray(_useReducer,2),_useReducer2$=_useReducer2[0],loading=_useReducer2$.loading,error=_useReducer2$.error,orders=_useReducer2$.orders,loadingDelete=_useReducer2$.loadingDelete,successDelete=_useReducer2$.successDelete,dispatch=_useReducer2[1];useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axios$get,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;dispatch({type:'FETCH_REQUEST'});_context.next=4;return axios.get(\"/api/orders\",{headers:{Authorization:\"Bearer \".concat(userInfo.token)}});case 4:_yield$axios$get=_context.sent;data=_yield$axios$get.data;dispatch({type:'FETCH_SUCCESS',payload:data});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);dispatch({type:'FETCH_FAIL',payload:getError(_context.t0)});case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();if(successDelete){dispatch({type:'DELETE_RESET'});}else{fetchData();}},[userInfo,successDelete]);var deleteHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(order){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!window.confirm('Är du säker?')){_context2.next=13;break;}_context2.prev=1;dispatch({type:'DELETE_REQUEST'});_context2.next=5;return axios.delete(\"/api/orders/\".concat(order._id),{headers:{Authorization:\"Bearer \".concat(userInfo.token)}});case 5:toast.success('Order Borttagen');dispatch({type:'DELETE_SUCCESS'});_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);toast.error(getError(error));dispatch({type:'DELETE_FAIL'});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function deleteHandler(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:\"Ordrar\"})}),/*#__PURE__*/_jsx(\"h1\",{children:\"Ordrar\"}),loadingDelete&&/*#__PURE__*/_jsx(LoadingBox,{}),loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Anv\\xE4ndare\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Datum\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Totalt\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Betald\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Skickad\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:orders.map(function(order){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:order._id}),/*#__PURE__*/_jsx(\"td\",{children:order.user?order.user.name:'Användare borttagen'}),/*#__PURE__*/_jsx(\"td\",{children:order.createdAt.substring(0,10)}),/*#__PURE__*/_jsx(\"td\",{children:order.totalPrice}),/*#__PURE__*/_jsx(\"td\",{children:order.isPaid?order.paidAt.substring(0,10):'Ej betald'}),/*#__PURE__*/_jsx(\"td\",{children:order.isDelievered?order.deliveredAt:'Ej Skickad'}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"light\",onClick:function onClick(){navigate(\"/order/\".concat(order._id));},children:\"Detaljer\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"light\",onClick:function onClick(){return deleteHandler(order);},disabled:!order.isPaid||!order.isDelievered,children:\"Radera\"})})]},order._id);})})]})]});}","map":{"version":3,"names":["React","useContext","useEffect","useReducer","Store","axios","getError","useNavigate","Helmet","LoadingBox","MessageBox","Button","toast","reducer","state","action","type","loading","orders","payload","error","loadingDelete","successDelete","OrderListScreen","navigate","userInfo","dispatch","fetchData","get","headers","Authorization","token","data","deleteHandler","order","window","confirm","delete","_id","success","map","user","name","createdAt","substring","totalPrice","isPaid","paidAt","isDelievered","deliveredAt"],"sources":["C:/Users/jonas/OneDrive/Skrivbord/E-comm/frontend/src/screens/OrderListScreen.js"],"sourcesContent":["import React, { useContext, useEffect, useReducer } from 'react'\r\nimport {Store} from \"../Store\"\r\nimport axios from \"axios\"\r\nimport { getError } from '../utils';\r\nimport {useNavigate} from \"react-router-dom\"\r\nimport {Helmet} from \"react-helmet-async\"\r\nimport LoadingBox from \"../components/LoadingBox\"\r\nimport MessageBox from \"../components/MessageBox\"\r\nimport Button from \"react-bootstrap/Button\"\r\nimport {toast} from \"react-toastify\"\r\n\r\n\r\nconst reducer = (state, action) => {\r\nswitch (action.type) {\r\ncase 'FETCH_REQUEST':\r\n    return{...state, loading: true}\r\n    case 'FETCH_SUCCESS':\r\n        return {\r\n            ...state,\r\n            orders: action.payload,\r\n            loading: false\r\n        };\r\n        case 'FETCH_FAIL':\r\n            return {...state, loading: false, error: action.payload};\r\n           \r\n\r\n                case 'DELETE_REQUEST':\r\n                    return {...state, loadingDelete: true, successDelete: false}\r\n                 case 'DELETE_SUCCESS':\r\n                    return {\r\n                        ...state,\r\n                        loadingDelete: false,\r\n                        successDelete: true\r\n                    }; \r\n\r\n                    case 'DELETE_FAIL':\r\n                         return {...state, loadingDelete: true}; \r\n                        \r\n                  case 'DELETE_RESET':\r\n                    return {...state, loadingDelete: false, successDelete: false}     \r\n                default:\r\n                    return state;     \r\n\r\n}\r\n}\r\n\r\n\r\n\r\nexport default function OrderListScreen() {\r\nconst navigate = useNavigate();\r\nconst {state} = useContext(Store)\r\nconst {userInfo} = state;\r\nconst [{loading, error, orders,loadingDelete,successDelete}, dispatch] = useReducer(reducer, {\r\n    loading: true,\r\n    error:''\r\n})\r\n\r\nuseEffect(() => {\r\nconst fetchData = async () => {\r\ntry {\r\n    dispatch({type: 'FETCH_REQUEST'})\r\n    const {data} = await axios.get(`/api/orders`, {\r\n        headers: {Authorization: `Bearer ${userInfo.token}`}\r\n\r\n    });\r\n\r\n    dispatch({type: 'FETCH_SUCCESS', payload: data})\r\n        }catch(err) {\r\n        dispatch({\r\n        type:'FETCH_FAIL',\r\n        payload: getError(err),\r\n        \r\n    })\r\n    \r\n\r\n\r\n}\r\n};\r\n\r\nif(successDelete) {\r\n    dispatch({type:'DELETE_RESET'})\r\n} else {\r\n   fetchData() \r\n}\r\n\r\n\r\n},[userInfo, successDelete])\r\n\r\nconst deleteHandler = async (order) => {\r\n    if(window.confirm('Är du säker?')) {\r\n        try {\r\n            dispatch({type: 'DELETE_REQUEST'})\r\n            await axios.delete(`/api/orders/${order._id}`,{\r\n                headers: {Authorization: `Bearer ${userInfo.token}`}\r\n            })\r\n            toast.success('Order Borttagen')\r\n            dispatch({type: 'DELETE_SUCCESS'})\r\n        } catch (err) {\r\n            toast.error(getError(error))\r\n            dispatch ({\r\n                type: 'DELETE_FAIL'\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\n  return (\r\n    <div>\r\n        <Helmet>\r\n            <title>Ordrar</title>\r\n        </Helmet>\r\n\r\n        <h1>Ordrar</h1>\r\n        {loadingDelete && <LoadingBox></LoadingBox>}\r\n        {loading ? (\r\n        <LoadingBox></LoadingBox>\r\n        ) : error ? (\r\n            <MessageBox variant =\"danger\">{error}</MessageBox>\r\n        ) : (\r\n            <table className='table'>\r\n<thead>\r\n    <tr>\r\n        <th>ID</th>\r\n        <th>Användare</th>\r\n        <th>Datum</th>\r\n        <th>Totalt</th>\r\n        <th>Betald</th>\r\n        <th>Skickad</th>\r\n        <th>Actions</th>\r\n          </tr>\r\n        </thead>\r\n            <tbody>\r\n                {orders.map((order) => (\r\n                    <tr key={order._id}>\r\n                           <td>{order._id}</td> \r\n                           <td>{order.user ? order.user.name : 'Användare borttagen'}</td>\r\n                           <td>{order.createdAt.substring(0,10)}</td>\r\n                           <td>{order.totalPrice}</td>\r\n                           <td>{order.isPaid ? order.paidAt.substring(0,10):'Ej betald'}</td>\r\n                           <td>{order.isDelievered ? order.deliveredAt : 'Ej Skickad'}</td>\r\n                           \r\n                           \r\n                           <td>\r\n                            <Button\r\n                            type=\"button\"\r\n                            variant=\"light\"\r\n                            onClick={() => {\r\n                                navigate(`/order/${order._id}`)\r\n                            }}>Detaljer</Button>\r\n                            </td>\r\n                            \r\n                            <td>\r\n                            <Button\r\n                            type=\"button\"\r\n                            variant=\"light\"\r\n                            onClick={() => deleteHandler(order)}\r\n                              disabled= {!order.isPaid || !order.isDelievered}\r\n                                >\r\n                            Radera\r\n                                </Button>\r\n                                \r\n                           \r\n                           </td>\r\n                           \r\n                    </tr>\r\n                ))}\r\n\r\n            \r\n            </tbody>\r\n            </table>\r\n        ) }\r\n    </div>\r\n  )\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}